plugins {
    id 'java-platform'
    id 'maven-publish'
    id "com.jfrog.artifactory" version '4.15.1'
}

ext {
    sharedDir           = file('shared')

    cradleVersion       = '1.5.2'

    slf4jVersion        = '1.7.30'
    grpcVersion         = '1.32.1'
}

group = 'com.exactpro.th2'
version = release_version

repositories {
    jcenter()
}

dependencies {
    constraints {
        // Libraries
        api('com.exactpro.th2:common:2.0.2')
        api('com.exactpro.th2:sailfish-utils:2.0.3')
        api('com.exactpro.th2:check1:2.0.0')
        api('com.exactpro.th2:check2:2.0.0')
        api('com.exactpro.th2:store-common:2.0.1')

        api("com.exactpro.cradle:cradle-cassandra:${cradleVersion}")
        api("com.exactpro.cradle:cradle-core:${cradleVersion}")

        api('com.google.protobuf:protobuf-java-util:3.13.0')
        api("io.grpc:grpc-protobuf:${grpcVersion}")
        api("io.grpc:grpc-stub:${grpcVersion}")
        api("io.grpc:grpc-core:${grpcVersion}")
        api("io.grpc:grpc-netty:${grpcVersion}")

        api("org.slf4j:slf4j-api:${slf4jVersion}")
        api("org.slf4j:slf4j-log4j12:${slf4jVersion}")

        // gRPC libraries
        api('com.exactpro.th2:grpc-common:2.0.3')
        api('com.exactpro.th2:grpc-act-fix:2.0.0')
        api('com.exactpro.th2:grpc-util:2.0.0')
        api('com.exactpro.th2:grpc-check1:2.0.0')
        api('com.exactpro.th2:grpc-sim:2.0.0')
        api('com.exactpro.th2:grpc-estore:2.0.4')
        api('com.exactpro.th2:grpc-conn:2.0.0')
    }
}

publishing {
    publishing {
        publications {
            th2Platform(MavenPublication) {
                from components.javaPlatform
            }
        }
    }

    repositories {
        repositories {
            maven {
                name = 'localRepo'
                url = sharedDir
            }
        }
    }
}

artifactory {
    publish {
        contextUrl = "${artifactory_url}"
        repository {
            repoKey = "${artifactory_deploy_repo_key}" // The Artifactory repository key to publish to
            username = "${artifactory_user}" // The publisher user name
            password = "${artifactory_password}" // The publisher password
        }
        defaults {
            // Reference to Gradle publications defined in the build script.
            // This is how we tell the Artifactory Plugin which artifacts should be
            // published to Artifactory.
            publications('th2Platform')
            publishArtifacts = true
            publishBuildInfo = true
            // Properties to be attached to the published artifacts.
            publishPom = true
        }
    }
}
