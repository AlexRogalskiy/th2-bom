plugins {
    id 'java-platform'
    id 'maven-publish'
    id "com.jfrog.artifactory" version '4.15.1'
}

ext {
    sharedDir           = file('shared')

    cradleVersion       = '1.5-SNAPSHOT' //FIXME: Migrate to release
}

group = 'com.exactpro.th2'
version = release_version

repositories {
    jcenter()
}

dependencies {
    constraints {
        // Libraries
        api('com.exactpro.th2:th2-common:1.4.2')
        api('com.exactpro.th2:th2-sailfish-utils:1.3.0')
        api('com.exactpro.th2:th2-verifier:1.3.1')
        api('com.exactpro.th2:th2-store-common:1.4.0')

        api("com.exactpro.cradle:cradle-cassandra:${cradleVersion}")
        api("com.exactpro.cradle:cradle-core:${cradleVersion}")

        // gRPC libraries
        api('com.exactpro.th2:th2-grpc-act:1.2.0')
        api('com.exactpro.th2:th2-grpc-utility:1.3.0')
        api('com.exactpro.th2:th2-grpc-verifier:1.3.1')
        api('com.exactpro.th2:th2-grpc-simulator:1.4.1')

        api('com.exactpro.th2:th2-store-common:1.3.0')
        api('com.exactpro.th2:th2-grpc-event-store:1.4.1')
    }
}

publishing {
    publishing {
        publications {
            th2Platform(MavenPublication) {
                from components.javaPlatform
            }
        }
    }

    repositories {
        repositories {
            maven {
                name = 'localRepo'
                url = sharedDir
            }
        }
    }
}

artifactory {
    publish {
        contextUrl = "${artifactory_url}"
        repository {
            repoKey = "${artifactory_deploy_repo_key}" // The Artifactory repository key to publish to
            username = "${artifactory_user}" // The publisher user name
            password = "${artifactory_password}" // The publisher password
        }
        defaults {
            // Reference to Gradle publications defined in the build script.
            // This is how we tell the Artifactory Plugin which artifacts should be
            // published to Artifactory.
            publications('th2Platform')
            publishArtifacts = true
            publishBuildInfo = true
            // Properties to be attached to the published artifacts.
            publishPom = true
        }
    }
}